Внешние функции
===============

В `yate` есть несколько видов функций, которые можно использовать в шаблонах:

  * Пользовательские функции. Например:

        func add(x, y) {
            x + y
        }

  * [Встроенные функции](built-in-functions.md), например: `name()`, `index()`, `count()`.

  * Внешние функции. Это функции, написанные на обычном javascript'е и которые специальным образом можно вызывать
    из `yate`-шаблонов.


yate-интерфейс
--------------

Прежде чем вызывать внешние функции внутри шаблонов, нужно их предварительно задекларировать:

    external scalar add(scalar, scalar)

Первым идет ключевое слово `external`, за ним тип значения, возвращаемое функцией.
Затем имя функции. В круглых скобках перечисляются типы аргументов, которые принимает функция.
По-умолчанию это `scalar`, так что в этом случае можно было бы написать так:

    external scalar add()

Само тело функции не определяется никак, только имя и сигнатура.


javascript-интерфейс
--------------------

Помимо декларации, нужно определить javascript-функцию, которая и будет делать всю работу.


### В браузере

Достаточно после подключения `runtime.js` написать:

    yr.externals['add'] = function(x, y) {
        return x + y;
    };


### В `node.js`

Перед вызовом `yr.run()` нужно сделать примерно следующее:

    var yr = require('yate/lib/runtime.js');

    yr.externals['add'] = function(x, y) {
        return x + y;
    };

Этот код можно использовать и как нодовский модуль.


Типы в сигнатурах
-----------------

В качестве типа аргументов и возвращаемого значения может быть:

  * `scalar`— строки и числа.

  * `xml` — то же, что и `scalar`, но при выводе не эскейпятся служебные символы.

  * `nodeset`. Сейчас в `runtime.js` нет никаких публичных методов для работы с внутренним представлением нодесетов.
    Так что если оно вдруг поменяется (а так, скорее всего, и будет), то функции, работающие с нодесетами, могут сломаться.

  * `array` и `object` — придут во внешнюю функцию как есть. Также можно и вернуть из функции объект или массив.

